<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>项目管理</title>
    <link rel="stylesheet" type="text/css"
          th:href="@{/webjars/bootstrap/4.0.0/css/bootstrap.min.css}"
          href="webjars/bootstrap/4.0.0/css/bootstrap.min.css"/>
    <link rel="icon" href="http://localhost:8080/image/logo.svg" type="image/x-icon">

    <script src="webjars/jquery/3.0.0/jquery.min.js"
            th:src="@{/webjars/jquery/3.0.0/jquery.min.js}"></script>
    <link rel="stylesheet" th:href="@{/css/container.css}"
          href="../../css/container.css"/>
    <script src="webjars/bootstrap/4.0.0/js/bootstrap.js"
            th:src="@{/webjars/bootstrap/4.0.0/js/bootstrap.js}"></script>
    <link rel="stylesheet" th:href="@{/css/document.css}"
          href="../css/document.css"/>

    <link rel="stylesheet" th:href="@{/css/project.css}"
          href="../css/project.css"/>
</head>
<body>
<div>
    <nav class="navbar navbar-expand-lg navbar-light fixed-top" style="background:#545C64 ;padding: 0px;">
        <a href="#" class="navbar-brand"
           style="display: flex;flex-direction: row;align-items: center">
            <svg t="1617175126380" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 p-id="1055" width="35px" height="35px">
                <path d="M813.607846 477.139349c0 154.326113-125.064842 279.463205-279.390955 279.463205S254.753687 631.465462 254.753687 477.139349c0-120.729838 76.512806-223.469414 183.731884-262.556692 29.839272-10.909758 62.135046-16.834262 95.73132-16.834262 99.705073 0 187.199887 52.164538 236.618924 130.772596a277.917054 277.917054 0 0 1 42.772031 148.618358z"
                      fill="#FDBA13" p-id="1056"></path>
                <path d="M349.762506 248.106682c-20.374515 10.693008-11.126508 40.026529-25.432018 98.332322-27.88852 113.649333-92.263318 121.235589-90.601567 192.185141 0.50575 22.469766 30.561772 67.9873 90.601567 159.022366 34.174275 51.875538 45.951034 64.591547 61.846045 65.169548 37.570028 1.300501 41.47153-67.192549 101.583574-100.499824 66.325549-36.703027 111.265081 18.929514 174.483878-14.37776 36.486277-19.218514 35.041276-44.795033 99.416073-174.483878 60.979045-122.89734 85.616313-146.884358 72.900303-164.585621-30.417272-42.338531-179.107881 83.737811-326.931489 26.51577C425.336062 303.450222 383.720031 230.260919 349.762506 248.106682z"
                      fill="#E65125" p-id="1057"></path>
                <path d="M536.384393 474.538348m-170.076625 0a170.076625 170.076625 0 1 0 340.153249 0 170.076625 170.076625 0 1 0-340.153249 0Z"
                      p-id="1058"></path>
            </svg>
            <span style="margin-left:5px;font-size: 14px; color: white">DEV-MANAGEMENT</span>
        </a>
        <div class="collapse navbar-collapse" id="navbarSupportedContent" style="margin-left: 50px; font-size: 12px;">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active" id="home">
                    <a class="nav-link text-white" href="/home/index">工作台</a>
                </li>
                <li class="nav-item" id="doc">
                    <a class="nav-link text-white" href="/doc/document">文档</a>
                </li>
                <li class="nav-item" id="project" style="background:#8f8f8f;border-radius: 2px;height: 16px">
                    <a class="nav-link text-white" href="/project/index">项目</a>
                </li>
                <li class="nav-item" id="msg">
                    <a class="nav-link text-white" href="/message/index">消息</a>
                </li>
                <li class="nav-item" id="setting">
                    <a class="nav-link text-white" href="/human/index">人员管理</a>
                </li>
            </ul>
        </div>
        <ul class="nav navbar-nav navbar-right "
            style="margin-right: 30px;display: flex;flex-direction: row;align-items: center">
            <li class="nav-item dropdown" style="display: flex;flex-direction: row" id="myself">
                <a class="dropdown-toggle nav-link" id="navbarScrollingDropdown" role="button" data-toggle="dropdown"
                   aria-expanded="false">
                    <span th:text="${session.username}"></span>
                </a>
                <ul class="dropdown-menu" aria-labelledby="navbarScrollingDropdown" style="width: 30px;padding: 0">
                    <li><a class="dropdown-item" href="/logout" style="font-size: 14px">退出</a></li>
                </ul>
            </li>
        </ul>
    </nav>
</div>
<div style="display: flex;flex-direction: row;height: 100%;margin-top: 30px">
    <div style="display: flex;flex-direction: column; height: 100%;width: 20%;margin-top: 20px" class="border-right">
        <div style="font-size: 15px;height: 45px;line-height: 45px;background: rgb(52, 58, 64);color: white;display:flex;justify-content: center;">
            我参与的项目
        </div>
        <ul class="list-group" id="project_list">
            <li class="list-group-item nav-item d-flex justify-content-between align-items-center "
                style="padding: 0px;border-radius: 0"
                th:each="project, value: ${project_list}">
                <a href="#" class="nav-link btn bg-light"
                   style="color: #545C64;display: flex;flex-direction: row;align-items: center;width: 100%"
                   th:href="@{'http://localhost:8080/project/index?id='+${project[id]}}">
                    <!--                    th:onclick="getDocument([[${project[id]}]])"-->
                    <svg t="1617465759897" class="icon" viewBox="0 0 1024 1024" version="1.1"
                         xmlns="http://www.w3.org/2000/svg" p-id="10374" width="30" height="30">
                        <path d="M523.024313 319.51484a16.906591 16.906591 0 0 1-12.054992-5.048953l-94.153925-95.65052-94.170371 95.765643a16.906591 16.906591 0 0 1-28.945137-11.857639V16.906591A16.906591 16.906591 0 0 1 310.606479 0h212.417834a16.906591 16.906591 0 0 1 16.906591 16.906591v285.783888a16.906591 16.906591 0 0 1-16.906591 16.824361z m-106.208917-141.699602a16.906591 16.906591 0 0 1 12.038546 5.048953l77.296672 78.480792V33.862521H327.496624v227.548246l77.296673-78.480791a16.906591 16.906591 0 0 1 12.022099-5.048953z"
                              fill="#545C64" p-id="10375"></path>
                        <path d="M828.231046 0.065784H195.714021A111.372992 111.372992 0 0 0 84.456152 111.323654v801.418476a111.372992 111.372992 0 0 0 111.257869 111.25787h632.517025a111.372992 111.372992 0 0 0 111.257869-111.25787V111.323654A111.372992 111.372992 0 0 0 828.231046 0.065784zM118.269334 111.323654a77.543364 77.543364 0 0 1 77.444687-77.444687h632.517025a77.543364 77.543364 0 0 1 77.444687 77.444687v634.441218a77.543364 77.543364 0 0 1-77.444687 77.444687H195.714021a77.543364 77.543364 0 0 1-77.444687-77.444687z m709.961712 878.863163H195.714021a77.543364 77.543364 0 0 1-77.444687-77.444687v-87.164332a110.846717 110.846717 0 0 0 77.444687 31.494282h632.517025a110.846717 110.846717 0 0 0 77.444687-31.494282v87.164332a77.526918 77.526918 0 0 1-77.444687 77.444687z"
                              fill="#545C64" p-id="10376"></path>
                    </svg>
                    <span th:text="${project[name]}" style="margin-left: 6px"></span>
                    <span th:text="${project[id]}" style="display: none"></span>
                </a>
            </li>
            <li style=" margin-top:10px;display:flex;justify-content: center;align-items: center">
                <!-- Button trigger modal -->
                <button type="button" class="btn btn-outline-warning btn-sm" data-toggle="modal"
                        data-target="#addProject">
                    添加项目
                </button>
            </li>
        </ul>
    </div>
    <div style="width: 70%;margin: 0 auto; margin-top: 20px; height: 70%;display: flex" class="border"
         th:if="${#strings.isEmpty(project_name)}">
        <img th:src="@{/image/nothing.svg}" width="500" height="500" style="margin: 0 auto"/>
    </div>
    <div style="width: 70%;margin: 0 auto; margin-top: 20px; height: 90%;display: flex;flex-direction: column"
         class="" data-bs-spy="scroll"
         th:if="not ${#strings.isEmpty(project_name)}">
        <div style="width: 100%;padding: 10px;height: 45px;display: flex;flex-direction: row;
        background:rgb(52, 58, 64); align-items: center;color: white;"
             class="border-left border-top border-right">
            <span style="padding:3px;font-size: 13px;color: white; border: #dddddd dashed 1px"
                  th:text="'我的角色：'+${role_name}"></span>
            <span th:text="${project_name}" style="margin-left: auto;"></span>
            <div class="input-group" style="width: fit-content;margin-left: auto;">
                <div class="input-group-sm">
                    <button class="btn btn-outline-warning btn-sm" type="button"
                            th:onclick="addDemand([[${project_id}]])" th:if="${role} eq 5">
                        添加需求
                    </button>
                    <button class="btn btn-outline-warning btn-sm" type="button"
                            th:onclick="search([[${project_id}]])" th:if="${role} eq 3">
                        添加缺陷
                    </button>
                </div>
            </div>
        </div>
        <div class="progress" style="border-radius: 0 !important">
            <div class="progress-bar bg-warning" role="progressbar" style=""
                 th:style="'width:'+${progress}+'%;border-radius: 0;color:black;font-weight:bolder'"
                 th:attr="aria-valuenow=${progress}" aria-valuemin="0" aria-valuemax="100" th:text="${progress}+'%'">
            </div>
        </div>
        <div class="border-left border-right">
            <nav class="navbar  navbar-expand-lg navbar-light bg-light">
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
                        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav">
                        <li class="nav-item"><a class="nav-link"
                                                th:href="@{'http://localhost:8080/project/index?id='+${project_id}+'&status=0'}"
                                                th:style="${status==0}? 'color: #eaa209':'' ">全部</a></li>
                        <li class="nav-item"><a class="nav-link"
                                                th:href="@{'http://localhost:8080/project/index?id='+${project_id}+'&status=1'}"
                                                th:style="${status==1}? 'color: #eaa209':'' ">进行中</a></li>
                        <li class="nav-item"><a class="nav-link"
                                                th:href="@{'http://localhost:8080/project/index?id='+${project_id}+'&status=2'}"
                                                th:style="${status==2}? 'color: #eaa209':'' ">已完成</a></li>
                        <li class="nav-item"><a class="nav-link"
                                                th:href="@{'http://localhost:8080/project/index?id='+${project_id}+'&status=3'}"
                                                th:style="${status==3}? 'color: #eaa209':'' ">已上线</a></li>
                        <li class="nav-item"><a class="nav-link"
                                                th:href="@{'http://localhost:8080/project/index?id='+${project_id}+'&status=4'}"
                                                th:style="${status==4}? 'color: #eaa209':'' ">已关闭</a></li>
                        <li class="nav-item"><a class="nav-link"
                                                th:href="@{'http://localhost:8080/project/index?id='+${project_id}+'&status=5'}"
                                                th:style="${status==5}? 'color: #eaa209':'' ">开发修复中</a></li>
                        <li class="nav-item"><a class="nav-link"
                                                th:href="@{'http://localhost:8080/project/index?id='+${project_id}+'&status=6'}"
                                                th:style="${status==6}? 'color: #eaa209':'' ">待上线</a></li>
                    </ul>
                </div>
            </nav>
        </div>
        <div class="overflow-auto border" style="height: 600px;overflow-y: auto;display: flex;flex-direction: column">
            <div class="border-bottom"
                 style="display: flex;flex-direction: row;align-items: center;justify-content: center"
                 th:each="task:${task_list}">
                <div class=""
                     style="display:flex;flex-direction:row;width: 15%;justify-content: center;align-items: center">
                    <span style="font-size: 14px" th:text="${task.userName}"></span>
                    <span class="badge rounded-pill" th:text="${task.role}"
                          style="background-color: #FFD04B;margin-left: 5px"></span>
                </div>
                <div class="border-left" style="display:flex;flex-direction:column; width: 85%">
                    <ul class="list-group">
                        <li class="list-group-item list-group-item-action border-bottom " style="height: 37px;line-height: 37px;display: flex;
                            flex-direction: row; align-items: center;font-size: 14px;"
                            th:each="item:${task.taskDtoList}"
                            th:styleappend="${item.border}"
                            th:classappend="${item.status==4}?'disabled':'a-black-color'">
                            <span class="badge rounded-pill badge-warning" th:if="${item.status} eq 1">进行中</span>
                            <span class="badge rounded-pill badge-dark" th:if="${item.status} eq 2">已完成</span>
                            <span class="badge rounded-pill badge-success" th:if="${item.status} eq 3">已上线</span>
                            <span class="badge rounded-pill badge-secondary" th:if="${item.status} eq 4">已关闭</span>
                            <span class="badge rounded-pill badge-warning" th:if="${item.status} eq 5">修复中</span>
                            <span class="badge rounded-pill badge-warning" th:if="${item.status} eq 6">待上线</span>
                            <span style="margin-left: 6px;" th:text="${item.title}"></span>
                            <div style="margin-left: auto;width: fit-content;">
                                <span class="badge rounded-pill badge-primary" th:text="${item.type}"></span>
                                <span class="badge rounded-pill badge-info" th:text="${item.endTime}"></span>
                                <span class="badge rounded-pill badge-danger"
                                      th:if="not ${#strings.isEmpty(item.outOfTime)}"
                                      th:text="${item.outOfTime}"></span>
                                <span class="badge rounded-pill badge-danger" th:if="${item.priority} eq 1">high</span>
                                <span class="badge rounded-pill badge-warning"
                                      th:if="${item.priority} eq 2">middle</span>
                                <span class="badge rounded-pill badge-success" th:if="${item.priority} eq 3">low</span>
                            </div>
                            <button class="btn btn-outline-info btn-sm" type="button"
                                    th:onclick="addTest([[${project_id}]],[[${item.id}]])"
                                    th:if="${role} eq 2 and ${item.type eq '需求'}"
                                    style="font-size: 10px;margin-left: 3px;height: 20px;line-height: 20px;padding: 0;padding-left: 4px;padding-right: 4px">
                                添加测试任务
                            </button>
                            <button class="btn btn-outline-info btn-sm" type="button"
                                    th:onclick="addBug([[${project_id}]],[[${item.id}]])"
                                    th:if="${role} eq 3 and ${item.type eq '需求'}"
                                    style="font-size: 10px;margin-left: 3px;height: 20px;line-height: 20px;padding: 0;padding-left: 4px;padding-right: 4px">
                                添加Bug
                            </button>
                            <button
                                    class="btn btn-outline-info" data-toggle="modal"
                                    style="font-size: 10px;margin-left: 3px;height: 20px;line-height: 20px;padding: 0;padding-left: 4px;padding-right: 4px"
                                    th:attr="data-target='#demandDetail'+${item.id}"
                                    th:if="${item.type eq '需求'}">详情
                            </button>
                            <button
                                    style="font-size: 10px;margin-left: 3px;height: 20px;line-height: 20px;padding: 0;padding-left: 4px;padding-right: 4px"
                                    class="btn btn-outline-info"
                                    th:attr="data-target='#testDetail'+${item.id}"
                                    th:if="${item.type eq '测试'}">详情
                            </button>
                            <!--                            <button-->
                            <!--                                    style="font-size: 10px;margin-left: 3px;height: 20px;line-height: 20px;padding: 0;padding-left: 4px;padding-right: 4px"-->
                            <!--                                    class="btn btn-outline-info"-->
                            <!--                                    th:if="${item.type eq '测试'}">详情-->
                            <!--                            </button>-->
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="addProject" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
     aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalCenterTitle">添加项目</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form action="/project/addProject" method="post">
                    <div class="form-group">
                        <label for="projectName">项目名称</label>
                        <input type="text" class="form-control" id="projectName" name="projectName"
                               placeholder="请输入项目名">
                        <small id="emailHelp" class="form-text text-muted">项目名不能和已有的项目名称重复</small>
                    </div>
                    <div style="margin-top: 10px"></div>
                    <button type="submit" class="btn btn-primary">提交</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                </form>
            </div>
        </div>
    </div>
</div>
<div class="footer" style="
    left: 0;
    bottom: 0;
    width: 100%;
    background-color: #f6f6f6;
    color: #808080;
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px">
    <span style="height: 40px;line-height: 40px ">© 2021 Copyright: 李景根</span>
</div>
<div th:each="item: ${demand_detail_list}">
    <div class="modal fade" th:id="'demandDetail'+${item.id}" th:if="${item.type eq '需求'}" tabindex="-1" role="dialog"
         aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel" th:text="${item.title}"></h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" style="font-size: 15px">
                    <div class="form-group">
                        <label for="detail"
                               style="padding-left:10px;font-weight: bolder;border-left: #FFC107 solid 4px">需求详情</label>
                        <textarea class="form-control" id="detail" style="min-height: 150px;overflow: auto"
                                  name="detail"
                                  th:text="${item.detail}" disabled>
                        </textarea>
                    </div>
                    <div class="form-group">
                        <label for="ms" style="padding-left:10px;font-weight: bolder;border-left: #FFC107 solid 4px">任务描述</label>
                        <div id="ms" style="display: flex;flex-direction: column; font-size: 14px">
                            <span>优&nbsp;&nbsp;先&nbsp;&nbsp;级：<span th:text="${item.priority}"></span></span>
                            <span>状&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;态：<span
                                    th:text="${item.status}"></span></span>
                            <span>任务类型：<span>需求</span></span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="cu"
                               style="padding-left:10px;font-weight: bolder;border-left: #FFC107 solid 4px">创建人</label>
                        <div id="cu" th:text="${item.createUser}" style="font-size: 14px"></div>
                    </div>
                    <div class="form-group">
                        <label for="fl" style="padding-left:10px;font-weight: bolder;border-left: #FFC107 solid 4px">相关文件</label>
                        <div id="fl" style="font-size: 14px">
                            <div th:each="str:${item.fileList}">
                                <a th:text="${str.name}" th:href="@{${str.path}}" class="text-warning"></a>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="bt" style="padding-left:10px;font-weight: bolder;border-left: #FFC107 solid 4px">开始时间</label>
                        <div id="bt" th:text="${item.beginTime}" style="font-size: 14px"></div>
                    </div>
                    <div class="form-group">
                        <label for="et" style="padding-left:10px;font-weight: bolder;border-left: #FFC107 solid 4px">结束时间</label>
                        <div id="et" th:text="${item.endTime}" style="font-size: 14px"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-dismiss="modal"
                            th:if="${item.status eq '已关闭'}">重新打开
                    </button>
                    <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">关闭弹框</button>
                    <button type="button" class="btn btn-outline-danger" data-dismiss="modal"
                            th:if="${item.status eq '进行中'}">关闭需求
                    </button>
                    <button type="button" class="btn btn-outline-success" data-dismiss="modal"
                            th:if="${item.status eq '进行中'}">完成需求
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<div th:each="testItem: ${test_detail_list}">
    <div class="modal fade" th:id="'testDetail'+${testItem.id}" tabindex="-1" role="dialog"
         aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="" th:text="${testItem.title}"></h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" style="font-size: 15px">
                    <div class="form-group">
                        <label for="testDetail"
                               style="padding-left:10px;font-weight: bolder;border-left: #FFC107 solid 4px">需求详情</label>
                        <textarea class="form-control" id="testDetail" style="min-height: 150px;overflow: auto"
                                  name="detail"
                                  th:text="${testItem.detail}" disabled>
                        </textarea>
                    </div>
                    <div class="form-group">
                        <label for="testMs"
                               style="padding-left:10px;font-weight: bolder;border-left: #FFC107 solid 4px">任务描述</label>
                        <div id="testMs" style="display: flex;flex-direction: column; font-size: 14px">
                            <span>优&nbsp;&nbsp;先&nbsp;&nbsp;级：<span th:text="${testItem.priority}"></span></span>
                            <span>状&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;态：<span
                                    th:text="${testItem.status}"></span></span>
                            <span>任务类型：<span>需求</span></span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="testCu"
                               style="padding-left:10px;font-weight: bolder;border-left: #FFC107 solid 4px">创建人</label>
                        <div id="testCu" th:text="${testItem.createUser}" style="font-size: 14px"></div>
                    </div>
                    <div class="form-group">
                        <label for="testbt"
                               style="padding-left:10px;font-weight: bolder;border-left: #FFC107 solid 4px">开始时间</label>
                        <div id="testbt" th:text="${testItem.beginTime}" style="font-size: 14px"></div>
                    </div>
                    <div class="form-group">
                        <label for="testet"
                               style="padding-left:10px;font-weight: bolder;border-left: #FFC107 solid 4px">结束时间</label>
                        <div id="testet" th:text="${testItem.endTime}" style="font-size: 14px"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-dismiss="modal"
                            th:if="${testItem.status eq '已关闭'}">重新打开
                    </button>
                    <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">关闭弹框</button>
                    <button type="button" class="btn btn-outline-danger" data-dismiss="modal"
                            th:if="${testItem.status eq '进行中'}">关闭需求
                    </button>
                    <button type="button" class="btn btn-outline-success" data-dismiss="modal"
                            th:if="${testItem.status eq '进行中'}">完成需求
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

</body>
</html>

<script>
    function getDocument(id) {
        $.ajax({
            url: "http://localhost:8080/directory/listByProject?id=" + id,
            dataType: "json",
            type: "Get",
            success: function (res) {
                console.log(res)
            },
        })
    }

    function addDemand(projectId) {
        window.location.href = "/project/demand?projectId=" + projectId
    }

    function addTest(projectId, taskId) {
        window.location.href = "/project/test?projectId=" + projectId + "&taskId=" + taskId
    }
</script>
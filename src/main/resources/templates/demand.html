<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Pragma" content="no-cache"/>
    <link rel="icon" href="http://localhost:8080/image/logo.svg" type="image/x-icon">
    <meta http-equiv="Cache-Control" content="no-cache"/>
    <meta http-equiv="Expires" content="0"/>
    <title>添加需求</title>
    <link rel="stylesheet" type="text/css"
          th:href="@{/webjars/bootstrap/4.0.0/css/bootstrap.min.css}"
          href="webjars/bootstrap/4.0.0/css/bootstrap.min.css"/>
    <link rel="stylesheet" th:href="@{/css/container.css}"
          href="../css/container.css"/>
    <link rel="stylesheet" th:href="@{/css/demand.css}"
          href="../css/demand.css"/>
    <link href="https://cdn.bootcss.com/gijgo/1.9.13/combined/css/gijgo.min.css" rel="stylesheet">
    <script src="webjars/jquery/3.0.0/jquery.min.js"
            th:src="@{/webjars/jquery/3.0.0/jquery.min.js}"></script>
    <script src="webjars/bootstrap/4.0.0/js/bootstrap.js"
            th:src="@{/webjars/bootstrap/4.0.0/js/bootstrap.js}"></script>
    <script src="https://cdn.bootcss.com/popper.js/1.15.0/esm/popper.min.js"></script>
    <script src="https://cdn.bootcss.com/gijgo/1.9.13/combined/js/gijgo.min.js"></script>
    <script src="https://cdn.bootcss.com/gijgo/1.9.13/combined/js/messages/messages.zh-cn.min.js"></script>
</head>
<body style="display: flex;justify-content: center;">
    <div style="display: flex;flex-direction: column; width: 55%;height: fit-content;margin-bottom: 15px"class="border">
        <div style="color: white;background: black;display: flex;justify-content: center;align-items: center;width: 100%;
                    height: 50px">
            <h5>添加需求</h5>
        </div>
        <div style="padding: 10px">
            <div style="display:flex;flex-direction: row;">
                <input type="text" disabled id="devMember">
                <button class="btn btn-outline-success btn-sm" style="margin-left: 10px;border-radius: 0"
                        data-toggle="modal" data-target="#myModal">分配开发人员
                </button>
                <div class="modal fade" id="myModal">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h4 class="modal-title">添加成员</h4>
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                            </div>
                            <div class="modal-body" style="height: 280px;">
                                <div class="dropdown">
                                    <button onclick="myFunction()" class="dropbtn">人员列表</button>
                                    <div id="myDropdown" class="dropdown-content">
                                        <input type="text" placeholder="搜索" id="myInput" onkeyup="filterFunction()">
                                        <a th:each="item:${add_user_list}"
                                           th:text="${item.userName}"
                                           th:onclick="addToProject([[${item.id}]],[[${item.userName}]])">
                                        </a>
                                    </div>
                                </div>
                                <div id="toBeAdd" class="bg-warning" style="font-size: 14px;width: fit-content;
                                            margin-left: 5px;border-radius: 6px;color: black;padding-left: 12px;padding-right: 12px;
                                            line-height: 35px; margin-top: 20px">
                                    <span id="toBeAddUserName"></span>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-outline-warning" data-dismiss="modal"
                                            th:onclick="allocate()">添加
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <form action="/project/addDemandReq" method="post" enctype="multipart/form-data" >
                <input type="text" style="display: none" id="formDevMember" name="userId">
                <input type="text" style="display: none" id="projectId" name="projectId" th:value="${project_id}">
                <div class="form-group">
                    <label for="title">标题</label>
                    <input type="text" class="form-control" id="title" placeholder="请输入标题" name="title">
                </div>
                <div class="form-group">
                    <label for="priority">优先级</label>
                    <select class="form-control" id="priority" name="priority">
                        <option>低</option>
                        <option>中</option>
                        <option>高</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="detail">需求详情</label>
                    <textarea class="form-control" id="detail" rows="3" style="height: 350px;" name="detail"></textarea>
                </div>
                <div class="form-group">
                    <input type="file" id="fileList" name="fileList" multiple>
                </div>
                <div class="form-group" style="margin-top: 10px">
                    <label for="dateselect">预期时间</label>
                    <div style="display:flex; flex-direction: row;" id="dateselect" >
                        <input id="datepicker_begin" name="beginTime">
                        <span class="input-group-addon" style="margin-left: 12px;margin-right: 12px">to</span>
                        <input id="datepicker_end" name="endTime">
                    </div>
                </div>
                <div class="form-group row" style="margin-left: auto;width: fit-content;margin-top: 20px;">
                    <div class="col-xs-6 col-sm-6 col-md-6">
                        <button type="button" class="btn btn-outline-secondary" id="close"
                            th:onclick="back([[${project_id}]])">返回</button>
                    </div>
                    <div class="col-xs-6 col-sm-6 col-md-6">
                        <button type="submit" class="btn btn-warning" id="submit">提交</button>
                    </div>
                </div>
            </form>

        </div>
    </div>
</body>


</html>

<script>
    let globalUserId;
    let globalUserName;
    $("#datepicker_begin").datepicker({
        locale: 'zh-cn',
        format: 'yyyy-mm-dd',
        weekStartDay: 1
    });
    $("#datepicker_end").datepicker({
        locale: 'zh-cn',
        format: 'yyyy-mm-dd',
        weekStartDay: 1
    });
    function back(projectId){
        window.location.href='/project/index?id='+projectId;
    }
    function myFunction() {
        document.getElementById("myDropdown").classList.toggle("show");
    }

    function filterFunction() {
        var input, filter, ul, li, a, i;
        input = document.getElementById("myInput");
        filter = input.value.toUpperCase();
        div = document.getElementById("myDropdown");
        a = div.getElementsByTagName("a");
        for (i = 0; i < a.length; i++) {
            txtValue = a[i].textContent || a[i].innerText;
            if (txtValue.toUpperCase().indexOf(filter) > -1) {
                a[i].style.display = "";
            } else {
                a[i].style.display = "none";
            }
        }
    }
    function addToProject(userId,userName) {
        document.getElementById("myDropdown").classList.toggle("show")
        globalUserId=userId
        globalUserName=userName
        $("#toBeAddUserName").text(userName)
    }
    function allocate(){
        $("#devMember").val(globalUserName)
        $("#formDevMember").val(globalUserId)
    }
</script>